<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Laporan Rekapitulasi Akreditasi - Sistem Akreditasi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap & FontAwesome -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

<style>
body {overflow-x: hidden; background-color: #f8f9fa;}
#wrapper {display: flex; width: 100%; min-height: 100vh;}
#sidebar-wrapper {
    min-width: 250px; max-width: 250px;
    background-color: #fff;
    border-right:1px solid #ddd;
    flex-shrink:0;
    transition: all 0.3s;
}
#page-content-wrapper {flex-grow:1; transition: all 0.3s;}
.profile-section{display:flex;align-items:center;padding:0.75rem 1rem;}
.profile-section img{width:35px;height:35px;border-radius:50%;margin-right:10px;}
.table-hover tbody tr:hover{background-color:#e9ecef;}
@media (max-width:768px){
    #sidebar-wrapper{margin-left:-250px;position:fixed;height:100%;z-index:1000;}
    #sidebar-wrapper.active{margin-left:0;box-shadow:2px 0 5px rgba(0,0,0,0.3);}
    #overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);z-index:900;}
    #overlay.active{display:block;}
}
</style>
</head>
<body class="bg-light">
<div id="wrapper">

<!-- Sidebar -->
<div class="border-end bg-white" id="sidebar-wrapper">
    <div class="sidebar-heading text-primary fs-4 p-3">Sistem Akreditasi</div>
    <div class="profile-section border-bottom mb-2">
        <img id="userPic" src="https://via.placeholder.com/35" alt="Profile">
        <div>
            <div class="fw-bold" id="sidebarUserName"></div>
            <span class="badge bg-info text-dark" id="sidebarUserRole"></span>
        </div>
    </div>
    <div class="list-group list-group-flush mt-2" id="sidebarMenu"></div>
    <button id="sidebarLogout" class="btn btn-outline-danger m-3 w-100">
        <i class="fa fa-sign-out-alt"></i> Logout
    </button>
</div>

<!-- Page Content -->
<div id="page-content-wrapper" class="w-100">
<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
<div class="container-fluid">
<button class="btn btn-primary" id="sidebarToggle"><i class="fa fa-bars"></i></button>
<div class="ms-auto d-flex align-items-center">
<div class="me-3 text-muted" id="currentDate"></div>
<img id="userPicNav" src="https://via.placeholder.com/35" class="rounded-circle me-2" alt="Profile">
<span id="userName" class="fw-bold me-2"></span>
<span class="badge bg-secondary" id="userRoleNav"></span>
</div>
</div>
</nav>

<div class="container-fluid p-4">
    <h2 class="text-primary mb-4">Laporan Rekapitulasi Akreditasi</h2>

    <div class="mb-3 d-flex justify-content-between">
        <div id="addRekapBtnContainer"></div>
        <input type="text" class="form-control w-25" id="searchInput" placeholder="Cari Prodi...">
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-striped table-bordered mb-0 table-hover" id="akredTable">
                <thead class="table-dark">
                    <tr>
                        <th>Prodi</th>
                        <th>Tanggal SK</th>
                        <th>Peringkat</th>
                        <th>Kedaluarsa</th>
                        <th>Aktif</th>
                        <th id="actionsHeader">Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>
</div>
</div>

<div id="overlay"></div>

<!-- Modal for Add/Edit Akreditasi -->
<div class="modal fade" id="rekapModal" tabindex="-1" aria-labelledby="rekapModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="rekapForm">
        <div class="modal-header">
          <h5 class="modal-title" id="rekapModalLabel">Tambah / Edit Akreditasi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="modalMode" value="add">
          <input type="hidden" id="modalIndex">
          <div class="mb-3">
            <label class="form-label">Fakultas</label>
            <input type="text" class="form-control" id="modalFakultas" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Prodi</label>
            <input type="text" class="form-control" id="modalProdi" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Tanggal SK</label>
            <input type="date" class="form-control" id="modalTanggal" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Peringkat</label>
            <input type="text" class="form-control" id="modalPeringkat" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Kedaluarsa</label>
            <input type="date" class="form-control" id="modalKedaluarsa" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Aktif</label>
            <select class="form-select" id="modalAktif">
                <option value="Ya">Ya</option>
                <option value="Tidak">Tidak</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="submit" class="btn btn-primary">Simpan</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ======= Current User =======
const user = JSON.parse(localStorage.getItem('currentUser')) || {user_role:"Administrator", name:"Admin"};
document.getElementById('userName').textContent = user.name;
document.getElementById('userRoleNav').textContent = user.user_role;
document.getElementById('sidebarUserName').textContent = user.name;
document.getElementById('sidebarUserRole').textContent = user.user_role;
document.getElementById('userPic').src = "https://via.placeholder.com/35";
document.getElementById('userPicNav').src = "https://via.placeholder.com/35";
document.getElementById('currentDate').textContent = new Date().toLocaleDateString();

// ======= Sidebar Menu =======
const menuItems = {
    "Administrator": [
        {text:"Dashboard", href:"dashboard.html", icon:"fa-tachometer-alt"},
        {text:"Manajemen Data User", href:"manajemen_user.html", icon:"fa-user-shield"},
        {text:"Manajemen Data Prodi", href:"manajemen_prodi.html", icon:"fa-graduation-cap"},
        {text:"Manajemen Data Fakultas", href:"manajemen_fakultas.html", icon:"fa-building"},
        {text:"Manajemen Data Akreditasi", href:"manajemen_akreditasi.html", icon:"fa-book"},
        {text:"Transaksi Status Akreditasi", href:"transaksi_status.html", icon:"fa-exchange-alt"},
        {text:"Laporan Detail Akreditasi", href:"laporan_detail.html", icon:"fa-file-alt"},
        {text:"Laporan Rekapitulasi Akreditasi", href:"laporan_rekap.html", icon:"fa-file"}
    ],
    "Kepala LPMPP": [
        {text:"Dashboard", href:"dashboard.html", icon:"fa-tachometer-alt"},
        {text:"Transaksi Status Akreditasi", href:"transaksi_status.html", icon:"fa-exchange-alt"},
        {text:"Laporan Detail Akreditasi", href:"laporan_detail.html", icon:"fa-file-alt"},
        {text:"Laporan Rekapitulasi Akreditasi", href:"laporan_rekap.html", icon:"fa-file"}
    ]
};
const sidebarMenu = document.getElementById('sidebarMenu');
menuItems[user.user_role].forEach(item => {
    const a = document.createElement('a');
    a.href = item.href;
    a.className = "list-group-item list-group-item-action bg-light d-flex align-items-center";
    a.innerHTML = `<i class="fa ${item.icon} me-2"></i>${item.text}`;
    if(window.location.pathname.endsWith(item.href)) a.classList.add("active","bg-primary","text-white");
    sidebarMenu.appendChild(a);
});

// Logout & Sidebar Toggle
document.getElementById('sidebarLogout').addEventListener('click',()=>{ localStorage.removeItem('currentUser'); window.location.href="login.html"; });
const sidebarWrapper = document.getElementById('sidebar-wrapper');
const overlay = document.getElementById('overlay');
document.getElementById('sidebarToggle').addEventListener('click',()=>{ sidebarWrapper.classList.toggle('active'); overlay.classList.toggle('active'); });
overlay.addEventListener('click',()=>{ sidebarWrapper.classList.remove('active'); overlay.classList.remove('active'); });

// ======= Dummy Akreditasi Data (10 rows) =======
let akreditasiData = [
    {fakultas:"Teknik", prodi:"S1 Teknik Elektro", tanggal_sk:"1998-12-22", peringkat:"A", kedaluarsa:"2001-12-22", aktif:"Tidak"},
    {fakultas:"Teknik", prodi:"S1 Teknik Mesin", tanggal_sk:"2005-06-10", peringkat:"A", kedaluarsa:"2010-06-10", aktif:"Ya"},
    {fakultas:"Ilmu Komputer", prodi:"S1 Sistem Informasi", tanggal_sk:"2015-03-15", peringkat:"A", kedaluarsa:"2020-03-15", aktif:"Tidak"},
    {fakultas:"Ekonomi", prodi:"S1 Akuntansi", tanggal_sk:"2020-08-01", peringkat:"B", kedaluarsa:"2025-08-01", aktif:"Ya"},
    {fakultas:"Hukum", prodi:"S1 Ilmu Hukum", tanggal_sk:"2018-05-12", peringkat:"B", kedaluarsa:"2023-05-12", aktif:"Ya"},
    {fakultas:"Psikologi", prodi:"S1 Psikologi", tanggal_sk:"2016-09-20", peringkat:"A", kedaluarsa:"2021-09-20", aktif:"Tidak"},
    {fakultas:"Kedokteran", prodi:"S1 Kedokteran", tanggal_sk:"2019-02-10", peringkat:"A", kedaluarsa:"2024-02-10", aktif:"Ya"},
    {fakultas:"Pertanian", prodi:"S1 Agribisnis", tanggal_sk:"2017-11-30", peringkat:"B", kedaluarsa:"2022-11-30", aktif:"Tidak"},
    {fakultas:"Farmasi", prodi:"S1 Farmasi", tanggal_sk:"2021-01-05", peringkat:"A", kedaluarsa:"2026-01-05", aktif:"Ya"},
    {fakultas:"Teknologi Informasi", prodi:"S1 Teknik Komputer", tanggal_sk:"2014-07-18", peringkat:"B", kedaluarsa:"2019-07-18", aktif:"Tidak"}
];

// ======= Add Rekap Button (Admin only) =======
if(user.user_role==="Administrator"){
    const addBtnContainer = document.getElementById('addRekapBtnContainer');
    const addBtn = document.createElement('button');
    addBtn.className="btn btn-success";
    addBtn.setAttribute("data-bs-toggle","modal");
    addBtn.setAttribute("data-bs-target","#rekapModal");
    addBtn.innerHTML='<i class="fa fa-plus"></i> Tambah Akreditasi';
    addBtnContainer.appendChild(addBtn);
} else {
    // Hide Actions column for Kepala LPMPP
    document.getElementById('actionsHeader').style.display = 'none';
}

// ======= Render Table =======
function renderAkredTable(){
    const tbody = document.querySelector('#akredTable tbody');
    tbody.innerHTML="";
    akreditasiData.forEach((a,index)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${a.prodi}</td>
                        <td>${a.tanggal_sk}</td>
                        <td>${a.peringkat}</td>
                        <td>${a.kedaluarsa}</td>
                        <td>${a.aktif}</td>`;
        const tdActions = document.createElement('td');
        if(user.user_role==="Administrator"){
            const btnEdit = document.createElement('button');
            btnEdit.className="btn btn-sm btn-light me-2"; btnEdit.innerHTML='<i class="fa fa-edit"></i>';
            btnEdit.onclick = ()=> {
                document.getElementById('modalMode').value="edit";
                document.getElementById('modalIndex').value=index;
                document.getElementById('modalFakultas').value = a.fakultas;
                document.getElementById('modalProdi').value = a.prodi;
                document.getElementById('modalTanggal').value = a.tanggal_sk;
                document.getElementById('modalPeringkat').value = a.peringkat;
                document.getElementById('modalKedaluarsa').value = a.kedaluarsa;
                document.getElementById('modalAktif').value = a.aktif;
            };
            const btnDelete = document.createElement('button');
            btnDelete.className="btn btn-sm btn-danger"; btnDelete.innerHTML='<i class="fa fa-trash"></i>';
            btnDelete.onclick = ()=> {
                if(confirm("Hapus data akreditasi ini?")){
                    akreditasiData.splice(index,1);
                    renderAkredTable();
                }
            };
            tdActions.appendChild(btnEdit);
            tdActions.appendChild(btnDelete);
        } else {
            tdActions.style.display = 'none';
        }
        tr.appendChild(tdActions);
        tbody.appendChild(tr);
    });
}

// ======= Modal Submit =======
document.getElementById('rekapForm').addEventListener('submit', e=>{
    e.preventDefault();
    const mode = document.getElementById('modalMode').value;
    const index = parseInt(document.getElementById('modalIndex').value);
    const newData = {
        fakultas: document.getElementById('modalFakultas').value,
        prodi: document.getElementById('modalProdi').value,
        tanggal_sk: document.getElementById('modalTanggal').value,
        peringkat: document.getElementById('modalPeringkat').value,
        kedaluarsa: document.getElementById('modalKedaluarsa').value,
        aktif: document.getElementById('modalAktif').value
    };
    if(mode==="add") akreditasiData.push(newData);
    else akreditasiData[index] = newData;
    renderAkredTable();
    bootstrap.Modal.getInstance(document.getElementById('rekapModal')).hide();
});

// ======= Search =======
document.getElementById('searchInput').addEventListener('input', e=>{
    const val = e.target.value.toLowerCase();
    renderAkredTableFiltered(val);
});

function renderAkredTableFiltered(search){
    const tbody = document.querySelector('#akredTable tbody');
    tbody.innerHTML="";
    akreditasiData.filter(a=>a.prodi.toLowerCase().includes(search)).forEach((a,index)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${a.prodi}</td>
                        <td>${a.tanggal_sk}</td>
                        <td>${a.peringkat}</td>
                        <td>${a.kedaluarsa}</td>
                        <td>${a.aktif}</td>`;
        const tdActions = document.createElement('td');
        if(user.user_role==="Administrator"){
            const btnEdit = document.createElement('button');
            btnEdit.className="btn btn-sm btn-light me-2"; btnEdit.innerHTML='<i class="fa fa-edit"></i>';
            btnEdit.onclick = ()=> {
                document.getElementById('modalMode').value="edit";
                document.getElementById('modalIndex').value=index;
                document.getElementById('modalFakultas').value = a.fakultas;
                document.getElementById('modalProdi').value = a.prodi;
                document.getElementById('modalTanggal').value = a.tanggal_sk;
                document.getElementById('modalPeringkat').value = a.peringkat;
                document.getElementById('modalKedaluarsa').value = a.kedaluarsa;
                document.getElementById('modalAktif').value = a.aktif;
            };
            const btnDelete = document.createElement('button');
            btnDelete.className="btn btn-sm btn-danger"; btnDelete.innerHTML='<i class="fa fa-trash"></i>';
            btnDelete.onclick = ()=> {
                if(confirm("Hapus data akreditasi ini?")){
                    akreditasiData.splice(index,1);
                    renderAkredTableFiltered(search);
                }
            };
            tdActions.appendChild(btnEdit);
            tdActions.appendChild(btnDelete);
        } else {
            tdActions.style.display = 'none';
        }
        tr.appendChild(tdActions);
        tbody.appendChild(tr);
    });
}

// ======= Initial Render =======
renderAkredTable();
</script>
</body>
</html>
