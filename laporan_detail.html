<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Laporan Detail Akreditasi - Sistem Akreditasi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap & FontAwesome -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

<style>
body {overflow-x: hidden;}
#wrapper {display: flex; width: 100%; min-height: 100vh;}
#sidebar-wrapper {min-width: 250px; max-width: 250px; background-color: #fff; border-right:1px solid #ddd; flex-shrink:0; transition: all 0.3s;}
#page-content-wrapper {flex-grow:1; transition: all 0.3s;}
.profile-section{display:flex;align-items:center;padding:0.75rem 1rem;}
.profile-section img{width:35px;height:35px;border-radius:50%;margin-right:10px;}
@media (max-width:768px){
    #sidebar-wrapper{margin-left:-250px;position:fixed;height:100%;z-index:1000;}
    #sidebar-wrapper.active{margin-left:0;box-shadow:2px 0 5px rgba(0,0,0,0.3);}
    #overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);z-index:900;}
    #overlay.active{display:block;}
}
</style>
</head>
<body class="bg-light">
<div id="wrapper">

<!-- Sidebar -->
<div class="border-end bg-white" id="sidebar-wrapper">
    <div class="sidebar-heading text-primary fs-4 p-3">Sistem Akreditasi</div>
    <div class="profile-section border-bottom mb-2">
        <img id="userPic" src="https://via.placeholder.com/35" alt="Profile">
        <div>
            <div class="fw-bold" id="sidebarUserName"></div>
            <span class="badge bg-info text-dark" id="sidebarUserRole"></span>
        </div>
    </div>
    <div class="list-group list-group-flush mt-2" id="sidebarMenu"></div>
    <button id="sidebarLogout" class="btn btn-outline-danger m-3 w-100">
        <i class="fa fa-sign-out-alt"></i> Logout
    </button>
</div>

<!-- Page Content -->
<div id="page-content-wrapper" class="w-100">
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container-fluid">
            <button class="btn btn-primary" id="sidebarToggle"><i class="fa fa-bars"></i></button>
            <div class="ms-auto d-flex align-items-center">
                <div class="me-3 text-muted" id="currentDate"></div>
                <img id="userPicNav" src="https://via.placeholder.com/35" class="rounded-circle me-2" alt="Profile">
                <span id="userName" class="fw-bold me-2"></span>
                <span class="badge bg-secondary" id="userRoleNav"></span>
            </div>
        </div>
    </nav>

    <div class="container-fluid p-4">
        <h2 class="text-primary mb-4">Laporan Detail Akreditasi</h2>

        <div class="mb-3 d-flex justify-content-between">
            <div id="addLaporanBtnContainer"></div>
            <input type="text" class="form-control w-25" id="searchInput" placeholder="Cari Prodi...">
        </div>

        <div class="card shadow-sm">
            <div class="card-body p-0">
                <table class="table table-striped table-bordered mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Prodi</th>
                            <th>Jenjang</th>
                            <th>Jenis PT</th>
                            <th>Nomor SK</th>
                            <th>Tahun</th>
                            <th>Tanggal Kedaluarsa</th>
                            <th>Status</th>
                            <th>Isi Laporan</th>
                            <th>Berkas</th>
                            <th id="aksiHeader">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="laporanTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</div>

<div id="overlay"></div>

<!-- Modal for Add/Edit Laporan -->
<div class="modal fade" id="laporanModal" tabindex="-1" aria-labelledby="laporanModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="laporanForm">
        <div class="modal-header">
          <h5 class="modal-title" id="laporanModalLabel">Tambah Laporan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="modalMode" value="add">
          <input type="hidden" id="modalIndex">

          <div class="mb-3">
            <label class="form-label">Prodi</label>
            <input type="text" class="form-control" id="modalProdi" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Jenjang</label>
            <input type="text" class="form-control" id="modalJenjang" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Jenis PT</label>
            <input type="text" class="form-control" id="modalJenisPT" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Nomor SK</label>
            <input type="text" class="form-control" id="modalNomorSK" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Tahun</label>
            <input type="number" class="form-control" id="modalTahun" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Tanggal Kedaluarsa</label>
            <input type="date" class="form-control" id="modalTanggalKadaluarsa" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Status Kedaluarsa</label>
            <select class="form-control" id="modalStatusKadaluarsa" required>
                <option value="Masih berlaku">Masih berlaku</option>
                <option value="Kedaluwarsa">Kedaluwarsa</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Isi Laporan</label>
            <textarea class="form-control" id="modalIsiLaporan" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Upload Berkas</label>
            <input type="file" id="modalFiles" multiple class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="submit" class="btn btn-primary">Simpan</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// ===== Current User =====
const user = JSON.parse(localStorage.getItem('currentUser')) || {user_role:"Administrator", name:"Admin"};
document.getElementById('userName').textContent = user.name;
document.getElementById('userRoleNav').textContent = user.user_role;
document.getElementById('sidebarUserName').textContent = user.name;
document.getElementById('sidebarUserRole').textContent = user.user_role;
document.getElementById('userPic').src = "https://via.placeholder.com/35";
document.getElementById('userPicNav').src = "https://via.placeholder.com/35";
document.getElementById('currentDate').textContent = new Date().toLocaleDateString();

// Sidebar Menu
const menuItems = {
    "Administrator": [
        {text:"Dashboard", href:"dashboard.html", icon:"fa-tachometer-alt"},
        {text:"Manajemen Data User", href:"manajemen_user.html", icon:"fa-user-shield"},
        {text:"Manajemen Data Prodi", href:"manajemen_prodi.html", icon:"fa-graduation-cap"},
        {text:"Manajemen Data Fakultas", href:"manajemen_fakultas.html", icon:"fa-building"},
        {text:"Manajemen Data Akreditasi", href:"manajemen_akreditasi.html", icon:"fa-book"},
        {text:"Transaksi Status Akreditasi", href:"transaksi_status.html", icon:"fa-exchange-alt"},
        {text:"Laporan Detail Akreditasi", href:"laporan_detail.html", icon:"fa-file-alt"},
        {text:"Laporan Rekapitulasi Akreditasi", href:"laporan_rekap.html", icon:"fa-file"}
    ],
    "Kepala LPMPP": [
        {text:"Dashboard", href:"dashboard.html", icon:"fa-tachometer-alt"},
        {text:"Transaksi Status Akreditasi", href:"transaksi_status.html", icon:"fa-exchange-alt"},
        {text:"Laporan Detail Akreditasi", href:"laporan_detail.html", icon:"fa-file-alt"},
        {text:"Laporan Rekapitulasi Akreditasi", href:"laporan_rekap.html", icon:"fa-file"}
    ]
};
const sidebarMenu = document.getElementById('sidebarMenu');
menuItems[user.user_role].forEach(item=>{
    const a = document.createElement('a');
    a.href = item.href;
    a.className="list-group-item list-group-item-action bg-light d-flex align-items-center";
    a.innerHTML = `<i class="fa ${item.icon} me-2"></i>${item.text}`;
    if(window.location.pathname.endsWith(item.href)) a.classList.add("active","bg-primary","text-white");
    sidebarMenu.appendChild(a);
});

// Logout & Sidebar toggle
document.getElementById('sidebarLogout').addEventListener('click',()=>{ localStorage.removeItem('currentUser'); window.location.href="login.html"; });
const sidebarWrapper = document.getElementById('sidebar-wrapper');
const overlay = document.getElementById('overlay');
document.getElementById('sidebarToggle').addEventListener('click',()=>{ sidebarWrapper.classList.toggle('active'); overlay.classList.toggle('active'); });
overlay.addEventListener('click',()=>{ sidebarWrapper.classList.remove('active'); overlay.classList.remove('active'); });

// ===== Dummy Data (10 entries) =====
let laporanDetails = [
    {id_laporan_detail:1, prodi:"Teknik Elektro", jenjang:"S1", jenis_pt:"PTN", nomor_sk:"0233/sk/lam/as/iv/2025", tahun:"2025", tanggal_kadaluarsa:"2030-04-20", status_kadaluarsa:"Masih berlaku", isi_laporan:"Evaluasi Prodi Teknik Elektro semester 1", files:["LKPS_TE_2025.pdf"]},
    {id_laporan_detail:2, prodi:"Sistem Informasi", jenjang:"S1", jenis_pt:"PTS", nomor_sk:"0456/sk/lam/as/ii/2025", tahun:"2025", tanggal_kadaluarsa:"2030-06-15", status_kadaluarsa:"Masih berlaku", isi_laporan:"Update borang akreditasi Sistem Informasi", files:["Borang_SI_2025.docx"]},
    {id_laporan_detail:3, prodi:"Manajemen", jenjang:"S1", jenis_pt:"PTN", nomor_sk:"0789/sk/lam/as/i/2025", tahun:"2025", tanggal_kadaluarsa:"2030-05-10", status_kadaluarsa:"Masih berlaku", isi_laporan:"Laporan hasil asesmen Prodi Manajemen", files:[]},
    {id_laporan_detail:4, prodi:"Akuntansi", jenjang:"S1", jenis_pt:"PTS", nomor_sk:"0111/sk/lam/as/iii/2024", tahun:"2024", tanggal_kadaluarsa:"2029-03-01", status_kadaluarsa:"Masih berlaku", isi_laporan:"Audit internal Prodi Akuntansi", files:["Audit_AK_2024.pdf"]},
    {id_laporan_detail:5, prodi:"Hukum", jenjang:"S1", jenis_pt:"PTN", nomor_sk:"0222/sk/lam/as/ii/2024", tahun:"2024", tanggal_kadaluarsa:"2029-08-10", status_kadaluarsa:"Masih berlaku", isi_laporan:"Laporan tahunan Prodi Hukum", files:["Laporan_Hukum_2024.docx"]},
    {id_laporan_detail:6, prodi:"Teknik Sipil", jenjang:"S1", jenis_pt:"PTS", nomor_sk:"0333/sk/lam/as/i/2023", tahun:"2023", tanggal_kadaluarsa:"2028-11-20", status_kadaluarsa:"Masih berlaku", isi_laporan:"Laporan Evaluasi Prodi Teknik Sipil", files:["Evaluasi_TS_2023.pdf"]},
    {id_laporan_detail:7, prodi:"Psikologi", jenjang:"S1", jenis_pt:"PTS", nomor_sk:"0444/sk/lam/as/iv/2024", tahun:"2024", tanggal_kadaluarsa:"2029-07-05", status_kadaluarsa:"Masih berlaku", isi_laporan:"Laporan kurikulum Prodi Psikologi", files:["Kurikulum_PS_2024.docx"]},
    {id_laporan_detail:8, prodi:"Ilmu Komunikasi", jenjang:"S1", jenis_pt:"PTN", nomor_sk:"0555/sk/lam/as/iii/2023", tahun:"2023", tanggal_kadaluarsa:"2028-12-12", status_kadaluarsa:"Masih berlaku", isi_laporan:"Update borang Ilmu Komunikasi", files:["Borang_IK_2023.pdf"]},
    {id_laporan_detail:9, prodi:"Biologi", jenjang:"S1", jenis_pt:"PTS", nomor_sk:"0666/sk/lam/as/ii/2025", tahun:"2025", tanggal_kadaluarsa:"2030-01-20", status_kadaluarsa:"Masih berlaku", isi_laporan:"Laporan akreditasi Biologi", files:["Akreditasi_BIO_2025.pdf"]},
    {id_laporan_detail:10, prodi:"Fisika", jenjang:"S1", jenis_pt:"PTN", nomor_sk:"0777/sk/lam/as/i/2024", tahun:"2024", tanggal_kadaluarsa:"2029-09-30", status_kadaluarsa:"Masih berlaku", isi_laporan:"Laporan Prodi Fisika", files:["Laporan_FIS_2024.docx"]}
];

// Hide Aksi header if not Admin
if(user.user_role !== "Administrator"){
    document.getElementById('aksiHeader').style.display = 'none';
}

// ===== Add Button for Admin =====
if(user.user_role==="Administrator"){
    const addBtnContainer = document.getElementById('addLaporanBtnContainer');
    const addBtn = document.createElement('button');
    addBtn.className="btn btn-success";
    addBtn.setAttribute("data-bs-toggle","modal");
    addBtn.setAttribute("data-bs-target","#laporanModal");
    addBtn.innerHTML='<i class="fa fa-plus"></i> Tambah Laporan';
    addBtnContainer.appendChild(addBtn);
}

// ===== Render Table =====
const laporanTableBody = document.getElementById('laporanTableBody');

function renderLaporanDetails(filter="") {
    laporanTableBody.innerHTML = "";
    const filteredData = laporanDetails.filter(ld => ld.prodi.toLowerCase().includes(filter.toLowerCase()));

    filteredData.forEach((ld, index) => {
        const aksiTd = user.user_role==="Administrator" ? `
            <td>
                <button class="btn btn-sm btn-light me-2" onclick="editLaporan(${index})"><i class="fa fa-edit"></i></button>
                <button class="btn btn-sm btn-danger" onclick="deleteLaporan(${index})"><i class="fa fa-trash"></i></button>
            </td>
        ` : '';
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${ld.prodi}</td>
            <td>${ld.jenjang}</td>
            <td>${ld.jenis_pt}</td>
            <td>${ld.nomor_sk}</td>
            <td>${ld.tahun}</td>
            <td>${ld.tanggal_kadaluarsa}</td>
            <td>${ld.status_kadaluarsa}</td>
            <td>${ld.isi_laporan}</td>
            <td>${ld.files.join(", ")}</td>
            ${aksiTd}
        `;
        laporanTableBody.appendChild(tr);
    });
}

// Edit/Delete
window.editLaporan = function(index) {
    const ld = laporanDetails[index];
    document.getElementById('modalMode').value = "edit";
    document.getElementById('modalIndex').value = index;
    document.getElementById('modalProdi').value = ld.prodi;
    document.getElementById('modalJenjang').value = ld.jenjang;
    document.getElementById('modalJenisPT').value = ld.jenis_pt;
    document.getElementById('modalNomorSK').value = ld.nomor_sk;
    document.getElementById('modalTahun').value = ld.tahun;
    document.getElementById('modalTanggalKadaluarsa').value = ld.tanggal_kadaluarsa;
    document.getElementById('modalStatusKadaluarsa').value = ld.status_kadaluarsa;
    document.getElementById('modalIsiLaporan').value = ld.isi_laporan;
    new bootstrap.Modal(document.getElementById('laporanModal')).show();
}

window.deleteLaporan = function(index) {
    if(confirm("Hapus laporan ini?")) {
        laporanDetails.splice(index,1);
        renderLaporanDetails(document.getElementById('searchInput').value);
    }
}

// Add/Edit form
document.getElementById('laporanForm').addEventListener('submit', e=>{
    e.preventDefault();
    const mode = document.getElementById('modalMode').value;
    const index = document.getElementById('modalIndex').value;
    const newData = {
        id_laporan_detail: Date.now(),
        prodi: document.getElementById('modalProdi').value,
        jenjang: document.getElementById('modalJenjang').value,
        jenis_pt: document.getElementById('modalJenisPT').value,
        nomor_sk: document.getElementById('modalNomorSK').value,
        tahun: document.getElementById('modalTahun').value,
        tanggal_kadaluarsa: document.getElementById('modalTanggalKadaluarsa').value,
        status_kadaluarsa: document.getElementById('modalStatusKadaluarsa').value,
        isi_laporan: document.getElementById('modalIsiLaporan').value,
        files: Array.from(document.getElementById('modalFiles').files).map(f=>f.name)
    };
    if(mode==="add") laporanDetails.push(newData);
    else laporanDetails[index] = {...laporanDetails[index], ...newData};
    renderLaporanDetails(document.getElementById('searchInput').value);
    bootstrap.Modal.getInstance(document.getElementById('laporanModal')).hide();
});

// Search
document.getElementById('searchInput').addEventListener('input', e=>{
    renderLaporanDetails(e.target.value);
});

// Initial render
renderLaporanDetails();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
